<!DOCTYPE html>
{% load static %}
<html lang="zh-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AP Memory 知识中心</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css"/>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">

    <style>
        /* === 全局基础样式 === */
        body {
            background-color: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            color: #333;
        }
        .navbar-brand img { height: 32px; margin-right: 10px; }
        .captcha { cursor: pointer; }

        /* 文章内容样式 (PC端默认) */
        .article-content {
            line-height: 1.8;
            color: #2c3e50;
            font-size: 16px; /* PC端正文大小 */
        }
        .article-content img {
            max-width: 100%;
            height: auto !important;
            border-radius: 6px;
            cursor: zoom-in;
            margin: 15px 0;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
        }
        /* 表格样式 */
        .article-content table {
            width: 100% !important;
            border-collapse: collapse;
            margin-bottom: 1rem;
            font-size: 0.95em;
        }
        .article-content table td, .article-content table th {
            border: 1px solid #dee2e6;
            padding: 0.75rem;
        }
        .table-responsive { overflow-x: auto; -webkit-overflow-scrolling: touch; }

        /* TOC 目录样式 */
        .toc-list { list-style: none; padding-left: 1rem; position: relative; }
        .toc-link { color: #666; text-decoration: none; font-size: 0.9rem; display: block; padding: 4px 0; border-left: 2px solid transparent; padding-left: 10px; transition: all 0.2s; }
        .toc-link:hover { color: #0d6efd; }
        .is-active-link { color: #0d6efd; font-weight: bold; border-left-color: #0d6efd; background-color: #f8f9fa; }

        /* 锚点偏移修复 */
        h1, h2, h3, h4 { scroll-margin-top: 80px; }

        /* ========================================= */
        /* 移动端深度优化 (Mobile)          */
        /* ========================================= */
        @media (max-width: 768px) {
            /* 1. 核心大招：降低根字体大小 (Bootstrap基于rem，会自动全局缩小) */
            html {
                font-size: 14px; /* PC通常是16px，手机改14px，整体缩小12.5% */
            }

            /* 2. 强制压缩标题大小 */
            h1, .h1 { font-size: 1.5rem !important; line-height: 1.3; } /* 约21px */
            h2, .h2 { font-size: 1.3rem !important; } /* 约18.2px */
            h3, .h3 { font-size: 1.15rem !important; }
            h4, .h4 { font-size: 1.05rem !important; }

            /* 3. 导航栏紧凑化 */
            .navbar-brand img { height: 26px; margin-right: 8px; } /* Logo变小 */
            .navbar-brand span { font-size: 1.1rem; } /* 品牌字变小 */
            .container { padding-left: 12px; padding-right: 12px; } /* 减少左右留白 */

            /* 4. 卡片与正文优化 */
            .card-body { padding: 1rem !important; } /* 卡片内边距减半 */
            .article-content {
                font-size: 1.05rem; /* 正文约 14.7px */
                line-height: 1.6;   /* 行高稍微紧凑一点 */
                text-align: justify; /* 两端对齐，手机阅读更整齐 */
            }

            /* 5. 表格字号缩小，防止撑破 */
            .article-content table { font-size: 0.85rem; }
            .article-content table td, .article-content table th { padding: 0.4rem; }

            /* 6. 底部留白减少 */
            .mb-5 { margin-bottom: 2rem !important; }
            .py-5 { padding-top: 2rem !important; padding-bottom: 2rem !important; }
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm mb-4 sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold d-flex align-items-center" href="{% url 'index' %}">
                <img src="https://www.apmemory.com/dist/assets/img/logo.svg" alt="AP Memory">
            </a>
            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain">
                <span class="navbar-toggler-icon" style="width: 1.2em; height: 1.2em;"></span> </button>
            <div class="collapse navbar-collapse" id="navbarMain">
                <ul class="navbar-nav ms-auto align-items-center py-2">
                    <li class="nav-item"><a class="nav-link" href="{% url 'index' %}">首页</a></li>
                    <li class="nav-item ms-lg-3 mt-2 mt-lg-0">
                        <a class="btn btn-primary btn-sm rounded-pill px-4 w-100" href="{% url 'feedback' %}">意见反馈</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container min-vh-100">
        {% if messages %}
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                {% for message in messages %}
                    Swal.fire({
                        text: "{{ message|safe }}",
                        icon: "{% if message.tags == 'error' %}error{% else %}success{% endif %}",
                        confirmButtonColor: '#0d6efd',
                        confirmButtonText: '确定'
                    });
                {% endfor %}
            });
        </script>
        {% endif %}

        {% block content %}{% endblock %}
    </div>

    <footer class="bg-white text-secondary text-center py-4 mt-5 border-top small">
        <div class="container">
            <small>Copyright &copy; AP Memory. All rights reserved.</small>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.18.2/tocbot.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>

    <script>
        // 验证码刷新
        document.addEventListener('click', function(e){
            if(e.target.classList.contains('captcha')){
                var url = location.protocol + "//" + location.host + "/captcha/refresh/";
                fetch(url, {headers: {'X-Requested-With': 'XMLHttpRequest'}})
                .then(response => response.json())
                .then(data => { e.target.src = data.image_url; });
            }
        });

        document.addEventListener("DOMContentLoaded", function() {
            // 代码高亮
            hljs.highlightAll();

            // 表格自适应
            document.querySelectorAll('.article-content table').forEach(function(table){
                table.classList.add('table', 'table-bordered', 'table-hover');
                var wrapper = document.createElement('div');
                wrapper.className = 'table-responsive';
                table.parentNode.insertBefore(wrapper, table);
                wrapper.appendChild(table);
            });

            // 图片灯箱 (Fancybox)
            document.querySelectorAll('.article-content img').forEach(function(img){
                if (img.parentElement.tagName === 'A') return;
                var link = document.createElement('a');
                link.href = img.src;
                link.setAttribute('data-fancybox', 'gallery');
                link.setAttribute('data-caption', img.alt || '图片预览');
                img.parentNode.insertBefore(link, img);
                link.appendChild(img);
            });
            Fancybox.bind("[data-fancybox]", {});
        });
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>