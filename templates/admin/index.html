{% extends "admin/base.html" %}
{% load i18n static %}

{% block title %}{% if subtitle %}{{ subtitle }} | {% endif %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block branding %}
<h1 id="site-name"><a href="{% url 'admin:index' %}">{{ site_header|default:_('Django administration') }}</a></h1>
{% endblock %}

{% block nav-global %}{% endblock %}

{% block content %}
<div id="content-main">
    {% if app_list %}
        {% for app in app_list %}
            <div class="app-{{ app.app_label }} module">
                <table>
                    <caption>
                        <a href="{{ app.app_url }}" class="section" title="{% blocktranslate with name=app.name %}Models in the {{ name }} application.{% endblocktranslate %}">{{ app.name }}</a>
                    </caption>
                    {% for model in app.models %}
                        <tr class="model-{{ model.object_name|lower }}">
                            {% if model.admin_url %}
                                <th scope="row"><a href="{{ model.admin_url }}">{{ model.name }}</a></th>
                            {% else %}
                                <th scope="row">{{ model.name }}</th>
                            {% endif %}

                            {% if model.add_url %}
                                <td><a href="{{ model.add_url }}" class="addlink">{% trans 'Add' %}</a></td>
                            {% else %}
                                <td>&nbsp;</td>
                            {% endif %}

                            <td>{{ model.object_count }}</td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
        {% endfor %}
    {% endif %}

    <!-- 自定义：媒体文件清理功能 -->
    <div class="module">
        <h2>媒体文件管理</h2>
        <div class="media-cleanup" style="padding: 10px; background: #f8f8f8; border: 1px solid #ddd; margin: 10px 0;">
            <p style="margin-bottom: 10px;">清理无引用的附件文件</p>
            <form method="post" action="{% url 'admin_cleanup_media' %}" style="display: inline;">
                {% csrf_token %}
                <input type="submit" value="执行清理" class="button" style="margin-right: 10px;" onclick="return confirm('确定要清理无引用的媒体文件吗？此操作不可撤销。')">
                <input type="submit" name="dry_run" value="预览模式" class="button" style="background: #7cf173;">
            </form>
        </div>
    </div>
</div>
{% endblock %}